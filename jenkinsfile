node {
    stage("GIT Clone"){
        
        git branch: 'main', credentialsId: 'GIT_CREDENTIALS', url: 'https://github.com/alagurajm1989/MyTestRepo1.git'
        
    }
        stage('Run Docker') {
           sshagent (['k8s-1']) {
              sh '''
               sudo docker run --rm -it --privileged --name dind-test docker:stable-dind docker login -u alagurajm1989 -p Jegan@1989
               sudo docker ps
               sudo cp -f incontainer.sh /root
               sudo docker cp /root/incontainer.sh dind-test:/opt
               sudo docker exec -t dind-test /bin/sh -c "chmod 755 /opt/incontainer.sh"
               sudo docker exec --privileged -t dind-test /bin/sh -c "sh /opt/incontainer.sh"
               '''
            }
        }
}
